<html>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <head>
        <style>
            
            div span.instructionText {
                top:2%;
                height:18%;
                left:2%;
                width:96%;
                text-align:left;
                display: block;
                position:absolute;
                font-size:10pt;
                color:#AAAAAA;
            }
        
            div span.mainText {
                top:25%;
                width:60%;
                left:20%;
                text-align:center;
                display: block;
                position:absolute;
            }
            div span.readyButton {
                top:2%;
                right:2%;
                padding:10px;
                background-color:#11AA11;
                color:#FFFFFF;
                text-align:center;
                display: block;
                position:absolute;
                font-size:10pt;
                cursor:pointer;
            }
            div div.keyboard {
                width:100%;
                height:50%;
                top:50%;
                left:0%;
                display: block;
                position:absolute;
            }
            span{
                font-size:14pt;
                font-family:Helvetica, Arial,sans-serif;
            }
            span.textarea{
                top:20%;
                height:30%;
                width:100%;
                display: block;
                position:absolute;
            }
            body{
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                margin:0px 0px 0px 0px;
            }
            body div{
                text-align:center;
                position:absolute;
                width:100%;
                height:100%;
                left:0%;
                top:0%;
            }
            div.key div {
                position: absolute;
                top: 50%;
                margin-top: -15px;
                height: 44px;
                width: 100%;
                font-size: 24pt;
                text-align: center;
                font-weight: bold;
                font-family: Arial, Helvetica, sans-serif;
            }
            #key_space div, #key_del div{
                margin-top: -7px;
                font-size: 11pt;
                font-weight: normal;
            }
            .key {
                padding: 0px, 0px, 0px, 0px;
                display: float;
                position: absolute;
                background-color: #CCC;
                cursor: pointer;
            }
        </style>
        </style>
        <title>Retype</title>
    </head>
    <body>
        <script>
            /************************************************/
            /* START                                        */
            /************************************************/
            
            function start(opts){
                options = opts;
                
                if(options == null || options["text"] == null ){
                    var words = shuffle(Words)
                    var text = words[0] + " " + words[1];
                    
                    options = {"text":text}
                }
                
                setupElements()
                
                startPart1()
            }
            
            function startPart1(){
                
            }
            
            /************************************************/
            /* CONSTANTS                                    */
            /************************************************/
            
            var Part1Duration = 10;
            var Part2Duration = 50;
            
            var KeyPositions = {
                q :{top:1,left:1},
                w :{top:1,left:11},
                e :{top:1,left:21},
                r :{top:1,left:31},
                t :{top:1,left:41},
                y :{top:1,left:51},
                u :{top:1,left:61},
                i :{top:1,left:71},
                o :{top:1,left:81},
                p :{top:1,left:91},
                a :{top:34,left:3},
                s :{top:34,left:13},
                d :{top:34,left:23},
                f :{top:34,left:33},
                g :{top:34,left:43},
                h :{top:34,left:53},
                j :{top:34,left:63},
                k :{top:34,left:73},
                l :{top:34,left:83},
                z :{top:67,left:6},
                x :{top:67,left:16},
                c :{top:67,left:26},
                v :{top:67,left:36},
                b :{top:67,left:46},
                n :{top:67,left:56},
                m :{top:67,left:66},
                space :{top:67,left:76},
                del :{top:67,left:88}
            };
            
            var KeyHeight = 32;
            var KeyWidth = 9;
            var SpaceKeyWidth = 11;
            
            var Words = [
                "aluminum",
                "octopus",
                "grain",
                "garden",
                "braid",
                "fancy",
                "yellow"
            ];
            
            /************************************************/
            /* VARIABLES                                    */
            /************************************************/
            
            var options = null;
            var div1 = null;
            var div2 = null;
            
            var isDebug = getDebugFromQueryString(window.location.search);
            
            var inputText = "";
            
            /************************************************/
            /* Query String                                 */
            /************************************************/
            
            function getDebugFromQueryString(queryString){
                return getValueFromQueryString("debug", queryString) == "true";
            }
            
            function getValueFromQueryString(key,queryString){
                
                if(queryString[0] == "?"){
                    queryString = queryString.substring(1)
                }
                
                var params = queryString.split("&");
                
                var value = null;
                
                for ( var index = 0; index < params.length; index++){
                    var pieces = params[index].split("=")
                    if(pieces[0] == key && pieces[1] != null && pieces[1].length > 0){
                        value = pieces[1]
                    }
                }
                
                return value;
                
            }
            
            /************************************************/
            /* META CONTROLLER                              */
            /************************************************/
            
            // this is available to be easily swapped out by the container with
            // custom logic (WKWebView on iOS, WebView on android)
            var metaController = {
                didComplete:function(opts, message){
                    setSavedOptions(opts);
                    alert(message)
                },
                didLoad:function(){
                    var opts = savedOptions();
                    start(opts)
                }
            };
            
            function didLoadHandler(){
                metaController.didLoad()
            }
            
            function savedOptions(){
                var key = "options";
                var options = null;
                try{
                    options = JSON.parse(localStorage.getItem(key))
                }catch(err){
                }
                return options
            }
        
            function setSavedOptions(options){
                var key = "options";
                localStorage.setItem(key, JSON.stringify( options ) )
            }
            
            /************************************************/
            /* SETUP                                        */
            /************************************************/
            
            function setupElements(){
                div1 = createDiv1()
                document.body.appendChild(div1);
                
                div2 = createDiv2()
                document.body.appendChild(div2);
                div2.style.display = "none";
            }
        
            function createDiv1(){
                var result = document.createElement("div")
                
                var span = document.createElement('span');
                span.innerText = options["text"]
                span.className = "mainText";
                result.appendChild(span);
                
                var instructionSpan = document.createElement('span');
                instructionSpan.innerText = "memorize the words below:";
                instructionSpan.className = "instructionText";
                result.appendChild(instructionSpan);
                
                var readyButton = document.createElement('span');
                readyButton.innerText = "I'm Ready >";
                readyButton.className = "readyButton";
                readyButton.addEventListener("click",didClickReadyButton);
                result.appendChild(readyButton);
                
                return result;

            }
        
        
            function createDiv2(){
                var result = document.createElement("div")
                
                var area = document.createElement('span');
                area.className = "textarea";
                area.id = "area";
                
                result.appendChild(area);
                
                var instructionSpan = document.createElement('span');
                instructionSpan.innerText = "type the memorized words below:";
                instructionSpan.className = "instructionText";
                result.appendChild(instructionSpan);
                
                var skipButton = document.createElement('span');
                skipButton.innerText = "Skip >";
                skipButton.className = "readyButton";
                skipButton.addEventListener("click",didClickSkipButton);
                result.appendChild(skipButton);
                
                var keyboardEl = document.createElement('div');
                keyboardEl.className = "keyboard";
                
                prepareKeyboard(keyboardEl)
                
                result.appendChild(keyboardEl);
                
                return result;
                
            }

            function prepareKeyboard(keyboardEl){
                //set our values
                var alphabet = "abcdefghijklmnopqrstuvwxyz";
                
                for(var i = 0; i < alphabet.length; i++){
                    var letter = alphabet.charAt(i);
                    var key = createKey(letter, KeyWidth, KeyHeight);
                    
                    keyboardEl.appendChild(key);
                    
                }

                var letter = "space";
                var key = createKey(letter, SpaceKeyWidth, KeyHeight);
                
                keyboardEl.appendChild(key);
                
                var letter = "del";
                var key = createKey(letter, KeyWidth, KeyHeight);
                
                keyboardEl.appendChild(key);
            }
            
            
            
            function createKey(letter, width, height){
                var keyViewDiv = document.createElement("div");
                keyViewDiv.letter = letter;
                keyViewDiv.className = "key";
                var letterDiv = document.createElement("div");
                letterDiv.innerHTML = letter.toUpperCase();
                keyViewDiv.appendChild(letterDiv);
                
                keyViewDiv.id = "key_"+letter;
                
                keyViewDiv.style.width = width+"%";
                keyViewDiv.style.height = height+"%";
                
                keyViewDiv.style.top = KeyPositions[letter].top+"%";
                keyViewDiv.style.left = KeyPositions[letter].left+"%";
                
                
                new ClickListener(keyViewDiv);
                
                return keyViewDiv;
            }
            
            /************************************************/
            /* RUN                                          */
            /************************************************/
            
            function shuffle(array) {
                var currentIndex = array.length, temporaryValue, randomIndex;

                // While there remain elements to shuffle...
                while (0 !== currentIndex) {

                    // Pick a remaining element...
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex -= 1;

                    // And swap it with the current element.
                    temporaryValue = array[currentIndex];
                    array[currentIndex] = array[randomIndex];
                    array[randomIndex] = temporaryValue;
                }

                return array;
            }
            function didTapKey(letter){
                var area = document.getElementById("area");
                if(letter == 'del'){
                    inputText = inputText.substring(0,area.innerText.length-1)
                }else if(letter == 'space'){
                    inputText = inputText + " "
                }else{
                    inputText = inputText + letter
                }
                area.innerText = inputText
                checkCompletion()
            }
            
            function checkCompletion(){
                var area = document.getElementById("area");
                var difference = compareStrings(inputText, options["text"])
                if(difference == ""){
                    metaController.didComplete({"advance_text":"true"},"congrats!")
                }
            }
            
        
            function didClickReadyButton(event){
                div1.style.display = "none"
                div2.style.display = "block"
            }
        
            function didClickSkipButton(event){
                metaController.didComplete({"advance_text":"false"},"no problem!")
            }
        
            function setKeyState(element,state){
                var backgroundColor = null;
                var color = null;
                switch(state){
                    case "active":
                        backgroundColor = "#FFFFFF";
                        color = "#FFFFFF";
                        break;
                }
                element.style.backgroundColor = backgroundColor;
                element.style.color = color;
            }
            
            function compareStrings(a,b){
                a = a.toLowerCase().replace(/\W/g,'')
                b = b.toLowerCase().replace(/\W/g,'')
                var result = "";
                var maxLength = a.length > b.length ? a.length : b.length
                for( var i  = 0; i < maxLength; i++ ){
                    if(a[i] != b[i]){
                        result = result + a[i];
                    }
                }
                return result;
            }
            
            
            function ClickListener(el) {
                this.element = typeof el == 'object' ? el : document.getElementById(el);
                this.element.addEventListener(this.startName, this, false);
            }
            
            ClickListener.prototype = {
                
                startName:(('ontouchstart' in document.documentElement)?'touchstart':'mousedown'),
                leaveName:(('ontouchstart' in document.documentElement)?'touchleave':'mouseout'),
                endName:(('ontouchstart' in document.documentElement)?'touchend':'mouseup'),
                
                handleEvent: function(e) {
                    switch(e.type) {
                        case this.startName: this.onStart(e); break;
                        case this.leaveName: this.onLeave(e); break;
                        case this.endName: this.onEnd(e); break;
                    }
                },
                
                onStart: function(e) {
                    
                    e.preventDefault();
                    this.moved = false;
                    
                    this.theTarget = document.elementFromPoint(e.target.clientX, e.target.clientY);
                    if(this.theTarget.nodeType == 3) {
                        this.theTarget = theTarget.parentNode;
                    }
                    setKeyState(this.element,"active");
                    
                    this.element.addEventListener(this.leaveName, this, false);
                    this.element.addEventListener(this.endName, this, false);
                },
                
                onLeave: function(e) {
                    this.element.removeEventListener(this.leaveName, this, false);
                    this.element.removeEventListener(this.endName, this, false);
                    setKeyState(this.element,"inactive");
                    this.theTarget = undefined;
                },
                
                onEnd: function(e) {
                    this.element.removeEventListener(this.leaveName, this, false);
                    this.element.removeEventListener(this.endName, this, false);
                    
                    if( !this.moved && this.theTarget ) {
                        setKeyState(this.element,"inactive");
                    }
                    
                    didTapKey(this.element.letter);
                    
                    this.theTarget = undefined;
                }
            };
            
        
            window.addEventListener("load", didLoadHandler,false)
            
        </script>
    </body>
</html>


