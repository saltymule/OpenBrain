<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <style>
            .canvas{
                position:absolute;
                left:0;
                top:0;
            }
            .score{
                position:absolute;
                left:5;
                top:5;
            }
            .debug{
                position:absolute;
                left:5;
            }
            body{
                -webkit-tap-highlight-color: rgba(0,0,0,0);
            }
        </style>
        <title>NBack</title>
    </head>
    <body>
        <script>

            /************************************************/
            /* CONSTANTS                                    */
            /************************************************/

            var GAME_STATE_NONE = 0;
            var GAME_STATE_RUNNING = 1;
            var GAME_STATE_COMPLETE = 2;

            var BUTTON_STATE_NONE = 0;
            var BUTTON_STATE_OVER = 1;
            var BUTTON_STATE_DOWN = 2;

            var TICKS_PER_ITEM = 1400;

            var N_BY_LEVEL = [0,
              1,1,1,
              2,2,2,
              3,3,3,
              4,4,4,
              5,5,5,
              6,6,6,
              7,7,7,
              8,8,8]
            var SPEED_BY_LEVEL = [0,
              0.8,1.0,1.2,
              0.8,1.0,1.2,
              0.8,1.0,1.2,
              0.8,1.0,1.2,
              0.8,1.0,1.2,
              0.8,1.0,1.2,
              0.8,1.0,1.2,
              0.8,1.0,1.2]
            var TOTAL_BY_LEVEL = [0,
              20,24,28,
              20,24,28,
              20,24,28,
              20,24,28,
              20,24,28,
              20,24,28,
              20,24,28,
              20,24,28]

            /************************************************/
            /* VARIABLES                                    */
            /************************************************/

            var options = null;
            var canvas = null;
            var scoreLabel = null;
            var prerenderedBuffers = {};
            var boardWidth = window.innerWidth;
            var boardHeight = window.innerHeight;

            var gameState = null;

            var isDebug = getDebugFromQueryString(window.location.search);

            /************************************************/
            /* START                                        */
            /************************************************/

            function start(opts){
                options = opts;

                if(options == null || options["level"] == null){
                    options = {"level":1}
                }

                if(getDebugFromQueryString(window.location.search)){
                    options["level"] = getLevelFromQueryString( window.location.search );
                }

                gameState = getNewGameState(options);
                startRendering()
            }

            /************************************************/
            /* META CONTROLLER                              */
            /************************************************/

            // this is available to be easily swapped out by the container with
            // custom logic (WKWebView on iOS, WebView on android)
            var metaController = {
                didComplete:function(opts, message){
                    setSavedOptions(opts);
                    alert(message)
                },
                didLoad:function(){
                    var opts = savedOptions();
                    start(opts)
                }
            };

            function didLoadHandler(){
                metaController.didLoad()
            }

            if(isDebug){

                //DEBUG customization goes here

            }



            /************************************************/
            /* Query String                                 */
            /************************************************/

            function getLevelFromQueryString(queryString){
                var level = new Number(getValueFromQueryString("level",queryString));
                return level > 0 ? level : 1;
            }

            function getDebugFromQueryString(queryString){
                return getValueFromQueryString("debug", queryString) == "true";
            }

            function getValueFromQueryString(key,queryString){

                if(queryString[0] == "?"){
                    queryString = queryString.substring(1)
                }

                var params = queryString.split("&");

                var value = null;

                for ( var index = 0; index < params.length; index++){
                    var pieces = params[index].split("=")
                    if(pieces[0] == key && pieces[1] != null && pieces[1].length > 0){
                        value = pieces[1]
                    }
                }

                return value;

            }

            /************************************************/
            /* DOM SETUP                                    */
            /************************************************/

            function updateScoreLabel(state){
                var score = state.indexOffset + state.firstIndex;
                scoreLabel.innerText = "count: "+score + " highscore: "+state.highscore;
            }

            function setupCanvas(isDebug){

                if(isDebug){
                    boardHeight = Math.floor(window.innerHeight*0.9);
                }

                canvas = document.createElement('canvas');
                canvas.className = "canvas";

                canvas.width = boardWidth;
                canvas.height = boardHeight;

                document.body.appendChild(canvas);


                scoreLabel = document.createElement('div');
                scoreLabel.className = "score";

                scoreLabel.innerText = "count: - highscore: - ";
                document.body.appendChild(scoreLabel);

            }


            /************************************************/
            /* EVENT HANDLING                               */
            /************************************************/

            function isTouchDevice() {
               var el = document.createElement('div');
               el.setAttribute('ontouchstart', 'return;'); // or try "ontouchstart"
               return typeof el.ontouchstart === "function";
            }

            function mousemoveCanvas(event){
                updateButtons(event,gameState.match,BUTTON_STATE_OVER)
            }

            function mouseoverCanvas(){
                updateButtons(event,gameState.match,BUTTON_STATE_OVER)
            }

            function mousedownCanvas(){
                updateButtons(event,gameState.match,BUTTON_STATE_DOWN)
            }

            function mouseupCanvas(){
                updateButtons(event,gameState.match,BUTTON_STATE_OVER)
            }

            function mouseoutCanvas(){
                gameState.match.state = BUTTON_STATE_NONE;
            }

            function touchstartCanvas(){
                updateButtons(event,gameState.match,BUTTON_STATE_DOWN)
            }

            function touchcancelCanvas(){
                gameState.match.state = BUTTON_STATE_NONE;
            }

            function touchendCanvas(){
                gameState.match.state = BUTTON_STATE_NONE;
            }

            function touchleaveCanvas(){
                gameState.match.state = BUTTON_STATE_NONE;
            }

            function updateButtons(event,button,buttonState){
                if(hasValidButtonEvent(event,button,gameState.state,canvas)){
                    button.state = buttonState;
                }else{
                    button.state = BUTTON_STATE_NONE;
                }
            }

            function didClickCanvas(event){
                if( hasValidButtonEvent(event,gameState.match,gameState.state,canvas) ){
                    gameState.lastMatch = hashForCurrentIndexes(gameState)
                    if(!userGaveCorrectInput(gameState)){
                        gameState.state = GAME_STATE_COMPLETE;
                    }
                }
            }

            function didTapButton(button){
                if( gameState.match == button && gameState.state == GAME_STATE_RUNNING ){
                    gameState.lastMatch = hashForCurrentIndexes(gameState)
                    if(!userGaveCorrectInput(gameState)){
                      gameState.state = GAME_STATE_COMPLETE;
                    }
                }
            }


            function hasValidButtonEvent(event,button,state,canvas){
                var isInGeometry = button.rect["x"] < event.offsetX &&
                        button.rect["y"] < event.offsetY &&
                        button.rect["x"] + button.rect["width"] > event.offsetX &&
                        button.rect["y"] + button.rect["height"] > event.offsetY;

                return  state == GAME_STATE_RUNNING &&
                        event.target == canvas &&
                        isInGeometry;
            }



            function startListeningForEvents(){

                new ClickListener(gameState.match);

                canvas.addEventListener("click",didClickCanvas);
                if(isTouchDevice()){
                    canvas.addEventListener("touchstart", touchstartCanvas);
                    canvas.addEventListener("touchend", touchendCanvas);
                    canvas.addEventListener("touchcancel", touchcancelCanvas);
                    canvas.addEventListener("touchleave", touchleaveCanvas);
                }else{
                    canvas.addEventListener("mousemove",mousemoveCanvas);
                    canvas.addEventListener("mouseover",mouseoverCanvas);
                    canvas.addEventListener("mousedown",mousedownCanvas);
                    canvas.addEventListener("mouseup",mouseupCanvas);
                    canvas.addEventListener("mouseout",mouseoutCanvas);
                }
            }

            function stopListeningForEvents(){
                canvas.removeEventListener("click",didClickCanvas);
                if(isTouchDevice()){
                    canvas.removeEventListener("touchstart", touchstartCanvas);
                    canvas.removeEventListener("touchend", touchendCanvas);
                    canvas.removeEventListener("touchcancel", touchcancelCanvas);
                    canvas.removeEventListener("touchleave", touchleaveCanvas);
                }else{
                    canvas.removeEventListener("mousemove",mousemoveCanvas);
                    canvas.removeEventListener("mouseover",mouseoverCanvas);
                    canvas.removeEventListener("mousedown",mousedownCanvas);
                    canvas.removeEventListener("mouseup",mouseupCanvas);
                    canvas.removeEventListener("mouseout",mouseoutCanvas);
                }
            }




            function ClickListener(button) {
                this.button = button
                window.addEventListener(this.keydownName, this, false);
            }

            ClickListener.prototype = {

                keydownName:'keydown',
                keyupName:'keyup',

                handleEvent: function(e) {
                    switch(e.type) {
                        case this.keydownName: this.onKeyStart(e); break;
                        case this.keyupName: this.onKeyEnd(e); break;
                    }
                },

                onKeyStart: function(e) {
                    var isUnmodified = !e.metaKey && !e.ctrlKey  && !e.altKey;
                    if( isUnmodified ){
                        e.preventDefault();
                        var key = this.stringFromKeyCode(e.keyCode ? e.keyCode : e.which)
                        if(key == this.button.letter){
                            this.button.state = BUTTON_STATE_DOWN;
                            window.addEventListener(this.keyupName, this, false);
                        }
                    }

                },

                onKeyEnd: function(e) {
                    var isUnmodified = !e.metaKey && !e.ctrlKey  && !e.altKey;
                    if( isUnmodified ){
                        e.preventDefault();
                    }
                    var key = this.stringFromKeyCode(e.keyCode ? e.keyCode : e.which)
                    if(key == this.element.letter){
                        window.removeEventListener(this.keyupName, this, false);
                        this.button.state = BUTTON_STATE_NONE;
                        if( isUnmodified ){
                            didTapKey(this.element.letter);
                        }
                    }
                },

                stringFromKeyCode: function(keyCode) {
                    if ( 65 <= keyCode && keyCode <= 90 ) {
                        return String.fromCharCode(keyCode).toLowerCase();
                    } else if( keyCode == 8 || keyCode == 46 ) {
                        return "del";
                    } else if( keyCode == 32 ){
                        return "space";
                    } else {
                        return "NOT FOUND"
                    }
                }

            };







            /************************************************/
            /* START/STOP                                   */
            /************************************************/

            function startRendering(){

                gameState.state = GAME_STATE_RUNNING;

                gameState.lastTimestamp = (new Date()).getTime();

                startListeningForEvents();

                window.requestAnimationFrame(render);
            }

            function reset(){
                options = {"level":1}
                gameState = getNewGameState(options);
            }

            function gameOver(){


                if(gameState != null){

                    stopListeningForEvents();

                    if(options == null){
                        options = {}
                    }

                    var level = gameState.level;

                    var highscore = highscoreForLevel(level, options)

                    var score = gameState.indexOffset + gameState.firstIndex;

                    if(score > highscore){
                        setHighscoreForLevel(level, options, score)
                    }

                    var message = "";

                    if (score >= gameState.itemsToNextLevel){

                        level++

                        message = "next level = "+level

                    }else{

                        var pointsLeft = gameState.itemsToNextLevel - score

                        message = ""+pointsLeft+" points to the next level"

                    }


                    options["level"] = level;

                    gameState = null;

                    metaController.didComplete(options, message)

                }else{
                    location.href = location.href
                }



            }


            /************************************************/
            /* RENDERING                                    */
            /************************************************/

            function render(){

                if( gameState && gameState.state == GAME_STATE_RUNNING ) {
                    //we might call game over here
                    gameState = updateState(gameState);

                }

                if( gameState ) {

                    drawState(gameState);

                    updateScoreLabel(gameState);
                    if( gameState.state == GAME_STATE_RUNNING ){
                      window.requestAnimationFrame(render);
                    }

                }

                if(gameState.state == GAME_STATE_COMPLETE){
                  gameOver();
                }
            }

            /************************************************/
            /* GAME STATE                                   */
            /************************************************/

            function getNewGameState(options){

                var level = options["level"];

                var n = N_BY_LEVEL[level];

                var speed = SPEED_BY_LEVEL[level];

                var total = TOTAL_BY_LEVEL[level];

                var itemCount = 3 + n;

                var highscore = highscoreForLevel(level, options);

                var items = [];

                for(var i = 0; i < itemCount; i++){
                    items.push(getRandomSymbol());
                }

                return {
                    "speed":speed,
                    "n":n,
                    "state":GAME_STATE_NONE,
                    "ticks":(n)*TICKS_PER_ITEM,
                    "level":level,
                    "internalTicks":(n)*TICKS_PER_ITEM,
                    "lastTimestamp":0,
                    "indexOffset":0,
                    "firstIndex":0,
                    "secondIndex":itemCount-3,
                    "items":items,
                    "maxItemCount":itemCount,
                    "pixelsPerTick":boardWidth/(TICKS_PER_ITEM*(itemCount - 1)),
                    "lastMatch":null,
                    "ticksToStartCover":TICKS_PER_ITEM*itemCount,
                    "ticksToFullCover":TICKS_PER_ITEM*(itemCount + 4),
                    "itemsToNextLevel":total,
                    "highscore":highscore,
                    "match":{
                        "letter":"z",
                        "title":"=",
                        "state":0,
                        "rect":{
                            "x":0,
                            "y":0,
                            "width":boardWidth*0.2,
                            "height":boardHeight*0.2,
                        },
                        "colors":{
                            0:{
                                "fill":"rgba(196,255,215,1.0)",
                                "stroke":'rgba(1,125,2,1.0)',
                                "text":'rgba(31,88,54,1.0)'
                            },
                            1:{
                                "fill":"rgba(255,255,255,1.0)",
                                "stroke":'rgba(1,125,2,1.0)',
                                "text":'rgba(31,88,54,1.0)'
                            },
                            2:{
                                "fill":"rgba(56,173,93,1.0)",
                                "stroke":'rgba(1,125,2,1.0)',
                                "text":'rgba(31,88,54,1.0)'
                            },
                        }
                    }
                };
            }

            //returns
            function incrementTicks(state){

                if(state.state == GAME_STATE_COMPLETE){
                  return
                }

                var timestamp = (new Date()).getTime();

                var t = timestamp - state.lastTimestamp; //in milleseconds

                var speed = state["speed"]; //average speed

                state.internalTicks = state.internalTicks + t*speed;

                state.lastTimestamp = (new Date()).getTime();

                var partialTicks = state.internalTicks%TICKS_PER_ITEM;
                var ticks = state.internalTicks - partialTicks

                var stillRatio = 0.6
                if(partialTicks > stillRatio*TICKS_PER_ITEM){
                    ticks = ticks + (partialTicks - stillRatio*TICKS_PER_ITEM)/(1 - stillRatio)
                }

                state.ticks = ticks ;

            }

            function updateState(state){

                incrementTicks(state);

                var itemIndex = state.ticks/TICKS_PER_ITEM;



                //we highlight the 0 index at the very start
                //following that, we highlight the 1 index, and the initial secondIndex + 1
                //This allows the 0 index to travel offscreen
                if( state.firstIndex == 0 &&  itemIndex - state.indexOffset > state.maxItemCount - 1 )
                {
                    if(!userGaveCorrectInput(state)){
                        state.state = GAME_STATE_COMPLETE;
                        return state;
                    }
                    state.firstIndex++;
                    state.secondIndex++;
                }

                  if( itemIndex - state.indexOffset > state.maxItemCount )
                {
                    if(!userGaveCorrectInput(state)){
                        state.state = GAME_STATE_COMPLETE;
                        return state;
                    }

                    var score = state.indexOffset + state.firstIndex

                    if(state.itemsToNextLevel <= score){
                      state.state = GAME_STATE_COMPLETE;
                      return state;
                    }


                    state.items.shift();
                    state.indexOffset= state.indexOffset+1;
                    if(state.indexOffset + state.firstIndex < state.itemsToNextLevel){
                      state.items.push(getNextSymbol(state, getRandomSymbol));
                    }

                }

                //add new elements, get rid of old elements

                state.match.rect = {
                                    "x":boardWidth*0.25,
                                    "y":boardHeight*0.8,
                                    "width":boardWidth*0.2,
                                    "height":boardHeight*0.2,
                                };
                return state;

            }

            function userGaveCorrectInput(state){
                //if we have a match, then the user should have indicated
                var matches = state.items[state.firstIndex] == state.items[state.secondIndex];

                var hash = hashForCurrentIndexes( state )

                //user must provide feedback on either a match or a non match
                if(matches){
                    return state.lastMatch == hash;
                }else{
                    return state.lastMatch != hash;
                }

            }

            function getNextSymbol(state, randFunc){

                var n = state["secondIndex"] - state["firstIndex"]

                if(Math.random() < 0.2){//one tenth of the time, enforce a match
                    console.log("enforcing match on "+ state.items[state.items.length - n])
                    return state.items[state.items.length - n]
                }else{
                    return randFunc()
                }

            }

            function getRandomSymbol(){
                var symbols = ["A","B","C","D"];
                var index = Math.floor(Math.random()*symbols.length)
                return symbols[index]
            }

            function clear(){
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0,0,boardWidth,boardHeight); // clear canvas
            }

            function highscoreForLevel(level, options){
                var key = "highscore-"+level;
                var val = options[key] ;
                if(isNaN(val)){
                    return 0
                }else{
                    return val
                }
            }

            function setHighscoreForLevel(level, options, score){
                var key = "highscore-"+level;
                options[key] = score;
            }

            function savedOptions(){
                var key = "nback-options";
                var options = null;
                try{
                    options = JSON.parse(localStorage.getItem(key))
                }catch(err){
                }
                return options
            }

            function setSavedOptions(options){
                var key = "options";
                localStorage.setItem(key, JSON.stringify( options ) )
            }

            function hashForCurrentIndexes(state){
                return (gameState.firstIndex + gameState.indexOffset) + " - " + (gameState.secondIndex + gameState.indexOffset)
            }

            /************************************************/
            /* DRAWING                                      */
            /************************************************/

            function drawState(state){

                var ctx = canvas.getContext('2d');

                ctx['prerenderedBuffers'] = prerenderedBuffers;

                ctx.clearRect(0,0,boardWidth,boardHeight); // clear canvas

                var y = Math.floor(boardHeight /4);
                var height = Math.floor(boardHeight /4);
                var xOffset = boardWidth /(state.maxItemCount - 1)
                var width = Math.floor(xOffset*(1 - 1/(state.maxItemCount-1)));

                var xPositions = [];

                for(var i = 0; i < state.items.length; i++){
                    var item = state.items[i];
                    var xPosition = boardWidth - state.ticks*state.pixelsPerTick + (i+state.indexOffset) * xOffset;
                    xPositions.push(xPosition);

                    var x = xPosition+ (xOffset - width)/2.0
                    drawMemoryElement(ctx, item , x , y, width, height);
                }

                drawFrame(ctx,
                    state.match.rect,
                    xOffset*0.90,
                    xPositions[state.firstIndex] + xOffset/2.0,
                    xPositions[state.secondIndex] + xOffset/2.0);

                if(state.state == GAME_STATE_RUNNING){

                  var visibleMargin = Math.floor(boardHeight*0.05);
                  var coverWidth = 0;
                  if(state.ticks > state.ticksToStartCover){
                      var fullCoverWidth = (state.secondIndex - state.firstIndex + 1)*xOffset;
                      if(state.ticks > state.ticksToFullCover){
                          coverWidth = fullCoverWidth;
                      }else{
                          coverWidth = fullCoverWidth*( ( state.ticks - state.ticksToStartCover ) / (state.ticksToFullCover - state.ticksToStartCover ) );
                      }
                  }
                  if(coverWidth > 0){
                    drawCover(ctx, 0, y + visibleMargin, coverWidth,height - visibleMargin*2);
                  }
                }

                drawMatchButton(ctx, state.match);

            }

            function drawCover(ctx, x,y,width, height ){
                ctx.fillStyle = 'rgb(32,139,171)';
                ctx.strokeStyle = 'rgba(1,77,155,1.0)';
                ctx.lineWidth =4.0;

                ctx.beginPath();
                ctx.moveTo(x,y);
                ctx.lineTo(x,y+height);
                ctx.lineTo(x+width,y+ height);
                ctx.lineTo(x+width,y);
                ctx.lineTo(x,y);
                ctx.closePath();

                ctx.fill()
                ctx.stroke()


            }

            function drawFrame(ctx, button1, width, firstX, secondX ){
                ctx.strokeStyle = 'rgba(0,0,0,1.0)';

                ctx.lineWidth = 2;

                ctx.beginPath();

                //first (left) element
                ctx.moveTo(firstX-width/2.0,boardHeight*0.55);
                ctx.lineTo(firstX-width/2.0,boardHeight*0.6);
                ctx.lineTo(firstX+width/2.0,boardHeight*0.6);
                ctx.lineTo(firstX+width/2.0,boardHeight*0.55);

                //second (right) element
                ctx.moveTo(secondX+width/2.0,boardHeight*0.55);
                ctx.lineTo(secondX+width/2.0,boardHeight*0.6);
                ctx.lineTo(secondX-width/2.0,boardHeight*0.6);
                ctx.lineTo(secondX-width/2.0,boardHeight*0.55);

                //connection beneath elements
                ctx.moveTo(secondX,boardHeight*0.6);
                ctx.lineTo(secondX,boardHeight*0.65);
                ctx.lineTo(firstX,boardHeight*0.65);
                ctx.lineTo(firstX,boardHeight*0.6);

                var elementMidX = (firstX+secondX)/2;
                //smaller inidivdual joiner
                ctx.moveTo(elementMidX,boardHeight*0.65);
                ctx.lineTo(elementMidX,boardHeight*0.70);

                var button1X = button1.x+button1.width/2.0;

                var leftX = Math.min(button1X,elementMidX);
                var rightX = Math.max(button1X,elementMidX);

                ctx.moveTo(leftX,boardHeight*0.70);
                ctx.lineTo(rightX,boardHeight*0.70);

                ctx.moveTo(button1X,boardHeight*0.70);
                ctx.lineTo(button1X,button1.y);

                ctx.stroke()

            }

            function drawMemoryElement(ctx, symbol, x,y,width,height){

                var key = symbol+"-"+width+"-"+height;

                var image = ctx['prerenderedBuffers'][key];

                if( image == null){
                    image = prerenderMemoryElement(symbol,width,height);
                    ctx['prerenderedBuffers'][key] = image;
                }

                ctx.drawImage(image, x, y);

            }

            function prerenderMemoryElement(symbol,width,height){
                var m_canvas = document.createElement('canvas');
                m_canvas.width = width;
                m_canvas.height = height;
                var m_context = m_canvas.getContext('2d');

                m_context.fillStyle = 'rgba(255,255,255,1)';
                m_context.strokeStyle = 'rgba(207,2,2,1.0)';

                m_context.beginPath();
                m_context.lineWidth = Math.floor(0.10*width);
                m_context.moveTo(0,0);
                m_context.lineTo(0,height);
                m_context.lineTo(width,height);
                m_context.lineTo(width,0);
                m_context.lineTo(0,0);
                m_context.closePath();

                //stroke then fill
                m_context.fill()
                m_context.stroke()

                var fontHeight = 40;

                m_context.fillStyle = 'rgba(0,0,0,1)';
                m_context.font = 'italic 40pt Calibri, sans-serif';
                m_context.fillText(symbol, (width-fontHeight)/2.0, (height-fontHeight)/2.0+fontHeight);
                return m_canvas;
            }

            function drawMatchButton(ctx, button){

                var key = button.title+"-"+button.state+"-"+button.rect.width+"-"+button.rect.height;

                var image = ctx['prerenderedBuffers'][key];

                if( image == null ){
                    image = prerenderMatchButton(button);
                    ctx['prerenderedBuffers'][key] = image;
                }

                ctx.drawImage(image, button.rect.x, button.rect.y);

            }

            function prerenderMatchButton(button){
                var m_canvas = document.createElement('canvas');
                m_canvas.width = button.rect.width;
                m_canvas.height = button.rect.height;

                var m_context = m_canvas.getContext('2d');
                var colors = button["colors"][button.state];
                m_context.fillStyle = colors.fill;
                m_context.strokeStyle = colors.stroke;
                m_context.beginPath();
                m_context.lineWidth = Math.floor(0.05*button.rect.width);
                m_context.moveTo(0,0);
                m_context.lineTo(0,button.rect.height);
                m_context.lineTo(button.rect.width,button.rect.height);
                m_context.lineTo(button.rect.width,0);
                m_context.lineTo(0,0);
                m_context.closePath();

                //stroke then fill
                m_context.fill()
                m_context.stroke()

                var fontHeight = 40;

                m_context.fillStyle = colors.text;
                m_context.font = 'italic 40pt sans-serif';
                m_context.fillText(button.title, (button.rect.width-fontHeight)/2.0, (button.rect.height-fontHeight)/2.0+fontHeight);

                return m_canvas;
            }

            setupCanvas(isDebug);

            window.addEventListener("load", didLoadHandler,false)

        </script>
    </body>
</html>
